cache:
  paths:
  - node_modules/

stages:
  - build

dev_build:
  stage: build
  only:
   - dev
  script:
   - yarn
   - npm run build
   - "sudo rsync -av --exclude=node_modules --exclude=.git --exclude=out . /usr/local/wechat-app && cd /usr/local/wechat-app && yarn && sudo PORT=702 pm2 start dev_server.js"

master_build:
  stage: build
  only: 
   - master
  script:
   - yarn
   - npm run build
   - "rsync -av out/. root@106.15.74.239:/data/wechat-app"